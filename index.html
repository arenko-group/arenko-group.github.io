<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Arenko Game</title>
    <style>
      body {
        background: #111;
        color: #fff;
        font-family: sans-serif;
        text-align: center;
        margin: 0;
        padding: 0;
      }
      #game {
        display: grid;
        margin: 20px auto;
        gap: 1px;
      }
      .cell {
        width: 20px;
        height: 20px;
        background: black;
      }
      .wall {
        background: #333;
      }
      .plus {
        background: green;
      }
      .minus {
        background: crimson;
      }
      .empty {
        background: black;
      }
      .pacman1 {
        background: gold;
        border-radius: 50%;
      }
      .pacman2 {
        background: deeppink;
        border-radius: 50%;
      }
      #scoreboard {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-top: 10px;
      }
      .score {
        font-size: 18px;
      }
      #controls {
        display: flex;
        justify-content: space-between;
        margin: 20px auto;
        max-width: 600px;
      }
      .control-set {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 5px;
      }
      .btn {
        padding: 15px;
        font-size: 20px;
        background: #333;
        color: #fff;
        border: none;
        border-radius: 5px;
      }
      .btn:active {
        background: #555;
      }
      #nameEntry,
      #gameMode,
      #replayPrompt {
        margin-top: 20px;
      }
      .keyboard {
        display: grid;
        grid-template-columns: repeat(10, 1fr);
        max-width: 300px;
        margin: 10px auto;
        gap: 5px;
      }
      .key-btn {
        padding: 10px;
        font-size: 16px;
        background: #222;
        color: #fff;
        border: none;
        border-radius: 3px;
      }
      #gameOverMessage {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: black;
        padding: 40px;
        border-radius: 10px;
        font-size: 32px;
        font-weight: bold;
        z-index: 10;
        color: white;
      }
    </style>
  </head>
  <body>
    <h1>Arenko Game - Balance the Grid!</h1>
    <div id="scoreboard">
      <div class="score" id="score1">Player 1: 0</div>
      <div class="score" id="score2">Player 2: 0</div>
    </div>
    <div id="frequency">Grid Frequency: <span id="freqVal">50.0</span>Hz</div>
    <div id="game"></div>
    <div id="controls">
      <div class="control-set">
        <button class="btn" onclick="setDir1(0, -1)">‚¨ÜÔ∏è</button>
        <button class="btn" onclick="setDir1(-1, 0)">‚¨ÖÔ∏è</button>
        <button class="btn" onclick="setDir1(1, 0)">‚û°Ô∏è</button>
        <button class="btn" onclick="setDir1(0, 1)">üîª</button>
      </div>
      <div class="control-set">
        <button class="btn" onclick="setDir2(0, -1)">W</button>
        <button class="btn" onclick="setDir2(-1, 0)">A</button>
        <button class="btn" onclick="setDir2(1, 0)">D</button>
        <button class="btn" onclick="setDir2(0, 1)">S</button>
      </div>
    </div>
    <div id="gameOverMessage">Game Over</div>
    <script>
      const width = 15,
        height = 15;
      let game = document.getElementById("game");
      let map = [];
      let pacman1 = { x: 1, y: 1, dx: 0, dy: 0, score: 0, alive: true };
      let pacman2 = {
        x: width - 2,
        y: height - 2,
        dx: 0,
        dy: 0,
        score: 0,
        alive: true,
      };
      let frequency = 50.0;
      let loop;

      function generateMap() {
        map = Array.from({ length: height }, (_, y) =>
          Array.from({ length: width }, (_, x) => {
            if (y === 0 || y === height - 1 || x === 0 || x === width - 1)
              return 1;
            if (Math.random() < 0.15) return 1;
            if (Math.random() < 0.15) return Math.random() < 0.5 ? 3 : 4; // 3=plus, 4=minus
            return 2; // empty
          }),
        );
        map[pacman1.y][pacman1.x] = 2;
        map[pacman2.y][pacman2.x] = 2;
      }

      function drawMap() {
        game.innerHTML = "";
        game.style.gridTemplateColumns = `repeat(${width}, 20px)`;
        for (let y = 0; y < height; y++) {
          for (let x = 0; x < width; x++) {
            let cell = document.createElement("div");
            cell.className = "cell";
            if (map[y][x] === 1) cell.classList.add("wall");
            else if (pacman1.x === x && pacman1.y === y && pacman1.alive)
              cell.classList.add("pacman1");
            else if (pacman2.x === x && pacman2.y === y && pacman2.alive)
              cell.classList.add("pacman2");
            else if (map[y][x] === 3) cell.classList.add("plus");
            else if (map[y][x] === 4) cell.classList.add("minus");
            else cell.classList.add("empty");
            game.appendChild(cell);
          }
        }
        document.getElementById("freqVal").textContent = frequency.toFixed(1);
      }

      function movePlayer(p) {
        if (!p.alive) return;
        let nx = p.x + p.dx;
        let ny = p.y + p.dy;
        if (map[ny]?.[nx] !== 1) {
          p.x = nx;
          p.y = ny;
          if (map[ny][nx] === 3) {
            frequency += 0.5;
            map[ny][nx] = 2;
          } else if (map[ny][nx] === 4) {
            frequency -= 0.5;
            map[ny][nx] = 2;
          }
        }
      }

      function update() {
        // Random drift: ¬±0.1 Hz occasionally
        if (Math.random() < 0.2) {
          frequency += (Math.random() - 0.5) * 0.2;
        }

        movePlayer(pacman1);
        movePlayer(pacman2);
        drawMap();

        const noItemsLeft = map
          .flat()
          .every((cell) => cell !== 3 && cell !== 4);
        if (noItemsLeft) {
          clearInterval(loop);
          let deviation = Math.abs(50 - frequency);
          let score = Math.max(0, 100 - deviation * 10);
          document.getElementById("gameOverMessage").textContent =
            `Game Over\nScore: ${Math.round(score)}`;
          document.getElementById("gameOverMessage").style.display = "block";
        }
      }

      function setDir1(dx, dy) {
        pacman1.dx = dx;
        pacman1.dy = dy;
      }
      function setDir2(dx, dy) {
        pacman2.dx = dx;
        pacman2.dy = dy;
      }

      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowUp") setDir1(0, -1);
        if (e.key === "ArrowDown") setDir1(0, 1);
        if (e.key === "ArrowLeft") setDir1(-1, 0);
        if (e.key === "ArrowRight") setDir1(1, 0);
        if (e.key === "w") setDir2(0, -1);
        if (e.key === "s") setDir2(0, 1);
        if (e.key === "a") setDir2(-1, 0);
        if (e.key === "d") setDir2(1, 0);
      });

      generateMap();
      drawMap();
      loop = setInterval(update, 200);
    </script>
  </body>
</html>
