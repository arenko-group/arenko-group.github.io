<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Grid Frequency Game</title>
    <style>
      /* Dim effect */
      .standard {
        filter: brightness(1);
        transition: filter 1s ease;
      }

      .dimmed {
        filter: brightness(0.5);
        transition: filter 1s ease;
      }

      .brightened {
        filter: brightness(1.5);
        transition: filter 0.75s ease;
      }

      /* Shake effect */
      @keyframes shake {
        0%,
        100% {
          transform: translate(0, 0);
        }
        20%,
        60% {
          transform: translate(-5px, 0);
        }
        40%,
        80% {
          transform: translate(5px, 0);
        }
      }

      .shaking {
        animation: shake 0.5s infinite;
        filter: contrast(1.5);
        transition: filter 1s ease;
      }
      body {
        background: #111;
        color: #fff;
        font-family: sans-serif;
        text-align: center;
        margin: 0;
        padding: 0;
      }
      #game-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      #game {
        display: grid;
        margin: 20px auto;
        gap: 1px;
      }
      .cell {
        width: 20px;
        height: 20px;
        background: black;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 14px;
        color: white;
      }
      .wall {
        background: transparent !important;
        border: none;
        box-shadow: none;
        width: 20px;
        height: 20px;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        /* Animation for glow */
        animation: wall-glow 2s infinite alternate;
      }

      /* Top border */
      .wall.top {
        border-top: 2px solid #00ffe7;
        box-shadow: 0 -2px 8px 0 #00ffe7, 0 -2px 16px 0 #00ffe7;
      }

      /* Bottom border */
      .wall.bottom {
        border-bottom: 2px solid #00ffe7;
        box-shadow: 0 2px 8px 0 #00ffe7, 0 2px 16px 0 #00ffe7;
      }

      /* Left border */
      .wall.left {
        border-left: 2px solid #00ffe7;
        box-shadow: -2px 0 8px 0 #00ffe7, -2px 0 16px 0 #00ffe7;
      }

      /* Right border */
      .wall.right {
        border-right: 2px solid #00ffe7;
        box-shadow: 2px 0 8px 0 #00ffe7, 2px 0 16px 0 #00ffe7;
      }

      @keyframes wall-glow {
        0% {
          filter: brightness(1.1) drop-shadow(0 0 4px #00ffe7);
        }
        100% {
          filter: brightness(1.5) drop-shadow(0 0 12px #00ffe7);
        }
      }
      .plus {
        background: #2c6; /* greenish */
        color: black;
      }
      .minus {
        background: #c33; /* reddish */
        color: white;
      }
      .empty {
        background: black;
      }
      .pacman1 {
        background: gold;
        border-radius: 50%;
      }
      #scoreboard {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-top: 10px;
      }
      #controls {
        display: flex;
        justify-content: center;
        margin: 20px auto;
      }
      .control-set {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 5px;
      }
      .btn {
        padding: 15px;
        font-size: 20px;
        background: #333;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      .btn:active {
        background: #555;
      }
      #gameOverMessage {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: black;
        padding: 40px;
        border-radius: 10px;
        font-size: 28px;
        font-weight: bold;
        z-index: 10;
        color: white;
        white-space: pre-line;
      }
      #frequency {
        margin-top: 10px;
        font-size: 18px;
      }
      #frequency span {
        font-weight: bold;
      }
      #start-screen-overlay {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: #000;
        z-index: 999;
        display: flex;
        align-items: center;
        justify-content: center;
        animation: flicker 2s linear, retroFadeIn 1.2s ease-out;
      }

      #start-screen {
        display: flex;
        width: 80%;
        max-width: 900px;
        background: #111;
        border: 2px solid #00ffe7;
        border-radius: 10px;
        padding: 40px;
        color: #00ffe7;
        font-family: 'Courier New', Courier, monospace;
        box-shadow: 0 0 12px #00ffe7, 0 0 20px #00ffe7;
        animation: glowPulse 2s infinite alternate;
      }

      .left-column, .right-column {
        flex: 1;
        padding: 20px;
      }

      .left-column input,
      .left-column button {
        width: 100%;
        padding: 12px;
        margin-top: 10px;
        background: #000;
        color: #00ffe7;
        border: 2px solid #00ffe7;
        font-size: 16px;
        font-family: inherit;
      }

      .left-column button {
        cursor: pointer;
        transition: 0.3s ease;
      }

      .left-column button:hover {
        background: #00ffe7;
        color: #000;
      }

      .right-column ul {
        list-style-type: square;
        padding-left: 20px;
        text-align: left;
        color: #fff;
      }

      @keyframes retroFadeIn {
        0% {
          opacity: 0;
          transform: scale(0.8);
          filter: brightness(0.4) contrast(1.5);
        }
        100% {
          opacity: 1;
          transform: scale(1);
          filter: brightness(1) contrast(1);
        }
      }

      @keyframes glowPulse {
        0% {
          box-shadow: 0 0 10px #00ffe7, 0 0 20px #00ffe7;
        }
        100% {
          box-shadow: 0 0 20px #00ffe7, 0 0 30px #00ffe7;
        }
      }

      @keyframes flicker {
        0%, 18%, 22%, 25%, 53%, 57%, 100% {
          opacity: 1;
        }
        19%, 21%, 24%, 56% {
          opacity: 0.6;
        }
      }

      .fade-out {
        animation: fadeOut 0.6s ease forwards;
      }

      @keyframes fadeOut {
        0% {
          opacity: 1;
          transform: scale(1);
        }
        100% {
          opacity: 0;
          transform: scale(0.95);
          pointer-events: none;
        }
      }

      #ready-go-overlay {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0, 0, 0, 0.85); /* darker overlay */
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        font-family: 'Courier New', Courier, monospace;
        font-size: 48px;
        font-weight: bold;
        color: #00ffe7;
        text-shadow: 0 0 10px #00ffe7;
        pointer-events: none;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.2s ease-in-out;
      }

      #ready-text, #go-text {
        opacity: 0;
        animation-duration: 0.6s;
        animation-fill-mode: forwards;
      }

      @keyframes showReady {
        0% { opacity: 0; transform: scale(0.8); }
        50% { opacity: 1; transform: scale(1.1); }
        100% { opacity: 0; transform: scale(1); }
      }

      @keyframes showGo {
        0% { opacity: 0; transform: scale(0.8); }
        50% { opacity: 1; transform: scale(1.1); }
        100% { opacity: 0; transform: scale(1); }
      }


    </style>
  </head>
  <body>
    <div id="start-screen-overlay">
      <div id="start-screen">
        <div class="left-column">
          <form id="start-form" onsubmit="return startGame(event)">
            <h2>Enter Your Name</h2>
            <input type="text" id="playerName" name="playerName" required autocomplete="off" />
            <button type="submit">Start Game</button>
          </form>
        </div>
        <div class="right-column">
          <h2>How to Play</h2>
          <ul>
            <li>üéØ Collect <strong>+</strong> to increase frequency and score.</li>
            <li>‚ö†Ô∏è Avoid <strong>‚àí</strong>, it lowers frequency.</li>
            <li>üéÆ Use arrow keys or buttons to move Pac-Man.</li>
            <li>üèÅ Game ends when all items are collected.</li>
            <li>üìà Stay close to 50.0Hz for best score!</li>
          </ul>
        </div>
      </div>
    </div>

    <div id="ready-go-overlay">
      <div id="ready-text">READY...</div>
      <div id="go-text">GO!</div>
    </div>


    <h1>Grid Frequency Game</h1>
    <div id="frequency">Grid Frequency: <span id="freqVal">50.0</span>Hz</div>
    <div id="timer">Time Survived: <span id="timeVal">0.00</span> seconds</div>
    <div id="game-container">
      <div id="game"></div>
    </div>
    <div id="controls">
      <div class="control-set">
        <button class="btn" onclick="setDir1(0, -1)">‚¨ÜÔ∏è</button>
        <button class="btn" onclick="setDir1(-1, 0)">‚¨ÖÔ∏è</button>
        <button class="btn" onclick="setDir1(1, 0)">‚û°Ô∏è</button>
        <button class="btn" onclick="setDir1(0, 1)">‚¨áÔ∏è</button>
      </div>
    </div>
    <div id="gameOverMessage">Game Over</div>

    <script>
      const width = 15,
        height = 15;
      let game = document.getElementById("game");
      let map = [];
      let pacman1 = { x: 1, y: 1, dx: 0, dy: 0, score: 0, alive: true };
      let frequency = 50.0;
      let loop;
      let paused = false;

      function generateMap() {
        map = Array.from({ length: height }, (_, y) =>
          Array.from({ length: width }, (_, x) => {
            if (y === 0 || y === height - 1 || x === 0 || x === width - 1)
              return 1;
            if (Math.random() < 0.15) return Math.random() < 0.5 ? 3 : 4;
            return 2;
          }),
        );
        map[pacman1.y][pacman1.x] = 2;
      }

      function startGame(e) {
        e.preventDefault();
        const name = document.getElementById("playerName").value.trim();
        if (!name) return;

        const overlay = document.getElementById("start-screen-overlay");
        overlay.classList.add("fade-out");

        setTimeout(() => {
          overlay.style.display = "none";
          showReadyGoFlash(); // Trigger READY/GO!
        }, 600);

        return false;
      }

      function showReadyGoFlash() {
        const overlay = document.getElementById("ready-go-overlay");
        const ready = document.getElementById("ready-text");
        const go = document.getElementById("go-text");

        // Pause the game logic
        paused = true;
        overlay.style.opacity = 1;

        ready.style.animation = "showReady 1s ease-out";
        setTimeout(() => {
          go.style.animation = "showGo 1s ease-out";
        }, 1000);

        setTimeout(() => {
          overlay.style.opacity = 0;
          ready.style.animation = "";
          go.style.animation = "";
          paused = false; // resume game
        }, 2000);
      }

      function drawMap() {
        game.innerHTML = "";
        game.style.gridTemplateColumns = `repeat(${width}, 20px)`;

        for (let y = 0; y < height; y++) {
          for (let x = 0; x < width; x++) {
            let cell = document.createElement("div");
            cell.className = "cell";

            if (map[y][x] === 1) {
              cell.classList.add("wall");
              if (y === 0) cell.classList.add("top");
              if (y === height - 1) cell.classList.add("bottom");
              if (x === 0) cell.classList.add("left");
              if (x === width - 1) cell.classList.add("right");
            } else if (pacman1.x === x && pacman1.y === y && pacman1.alive) {
              cell.classList.add("pacman1");
            } else if (map[y][x] === 3) {
              cell.classList.add("plus");
              cell.textContent = "+";
            } else if (map[y][x] === 4) {
              cell.classList.add("minus");
              cell.textContent = "‚àí";
            } else {
              cell.classList.add("empty");
            }

            game.appendChild(cell);
          }
        }

        const freqValEl = document.getElementById("freqVal");
        freqValEl.textContent = frequency.toFixed(5);

        if (frequency >= 49.8 && frequency <= 50.2) {
          freqValEl.style.color = "lightgreen";
        } else if (frequency >= 49.5 && frequency <= 50.5) {
          freqValEl.style.color = "orange";
        } else {
          freqValEl.style.color = "red";
        }
      }

      function movePlayer(p) {
        if (!p.alive) return;
        let nx = p.x + p.dx;
        let ny = p.y + p.dy;
        if (map[ny]?.[nx] !== 1) {
          p.x = nx;
          p.y = ny;
          if (map[ny][nx] === 3) {
            frequency += 0.1;
            map[ny][nx] = 2;
          } else if (map[ny][nx] === 4) {
            frequency -= 0.1;
            map[ny][nx] = 2;
          }
        }
      }

      let tickCount = 0;
      let startTime = Date.now();

      function update() {
        if (paused) return; // stop updating during overlay

        tickCount++;

        const maxTicks = 150;
        const progress = Math.min(tickCount / maxTicks, 1);
        const maxDeviation = 0.1;
        const minDeviation = 0.01;
        const currentDeviation =
          minDeviation + (maxDeviation - minDeviation) * progress;

        if (Math.random() < 0.2) {
          frequency += (Math.random() - 0.5) * currentDeviation * 2;
        }

        movePlayer(pacman1);
        drawMap();

        // Update timer on screen
        const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
        document.getElementById("timeVal").textContent = elapsed;

        const body = document.body;

        if (frequency < 49.8) {
          body.classList.add("dimmed");
          body.classList.add("shaking");
        } else {
          body.classList.remove("dimmed");
          body.classList.remove("shaking");
          body.classList.add("standard");
        }

        if (frequency > 50.2) {
          body.classList.add("brightened");
          body.classList.add("shaking");
        } else {
          body.classList.remove("brightened");
          body.classList.remove("shaking");
          body.classList.add("standard");
        }

        // Check if frequency out of bounds -> game over
        if (frequency < 49.5 || frequency > 50.5) {
          clearInterval(loop);
          document.getElementById("gameOverMessage").textContent =
            `üõë Grid Out of Limits\nYou survived ${elapsed} seconds`;
          document.getElementById("gameOverMessage").style.display = "block";
          return;
        }

        // Check if all plus and minus are collected
        const noItemsLeft = map
          .flat()
          .every((cell) => cell !== 3 && cell !== 4);

        if (noItemsLeft) {
          // Generate 10 new items randomly on empty cells (value 2)
          for (let i = 0; i < 10; i++) {
            let rx, ry;
            do {
              rx = Math.floor(Math.random() * width);
              ry = Math.floor(Math.random() * height);
            } while (
              map[ry][rx] !== 2 ||
              (rx === pacman1.x && ry === pacman1.y)
            );

            map[ry][rx] = Math.random() < 0.5 ? 3 : 4;
          }

          // Increase game speed by decreasing intervalDelay, minimum 50ms
          if (intervalDelay > 50) {
            clearInterval(loop);
            intervalDelay = Math.max(50, intervalDelay - 20);
            loop = setInterval(update, intervalDelay);
          }
        }
      }
      function setDir1(dx, dy) {
        pacman1.dx = dx;
        pacman1.dy = dy;
      }

      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowUp") setDir1(0, -1);
        if (e.key === "ArrowDown") setDir1(0, 1);
        if (e.key === "ArrowLeft") setDir1(-1, 0);
        if (e.key === "ArrowRight") setDir1(1, 0);
      });

      generateMap();
      drawMap();
      loop = setInterval(update, 200);
    </script>
  </body>
</html>
