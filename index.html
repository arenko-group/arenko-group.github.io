<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Grid Frequency Game</title>
    <style>
      body {
        background: #111;
        color: #fff;
        font-family: sans-serif;
        text-align: center;
        margin: 0;
        padding: 0;
      }
      #game-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      #game {
        display: grid;
        margin: 20px auto;
        gap: 1px;
      }
      .cell {
        width: 20px;
        height: 20px;
        background: black;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 14px;
        color: white;
      }
      .wall {
        background: transparent !important;
        border: none;
        box-shadow: none;
        width: 20px;
        height: 20px;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        /* Animation for glow */
        animation: wall-glow 2s infinite alternate;
      }

      /* Top border */
      .wall.top {
        border-top: 2px solid #6f9dba;
        box-shadow: 0 -2px 8px 0 #6f9dba, 0 -2px 16px 0 #00ffe7;
      }

      /* Bottom border */
      .wall.bottom {
        border-bottom: 2px solid #6f9dba;
        box-shadow: 0 2px 8px 0 #6f9dba, 0 2px 16px 0 #00ffe7;
      }

      /* Left border */
      .wall.left {
        border-left: 2px solid #6f9dba;
        box-shadow: -2px 0 8px 0 #6f9dba, -2px 0 16px 0 #00ffe7;
      }

      /* Right border */
      .wall.right {
        border-right: 2px solid #6f9dba;
        box-shadow: 2px 0 8px 0 #6f9dba, 2px 0 16px 0 #00ffe7;
      }

      @keyframes wall-glow {
        0% {
          filter: brightness(1.1) drop-shadow(0 0 4px #6f9dba);
        }
        100% {
          filter: brightness(1.5) drop-shadow(0 0 12px #00ffe7);
        }
      }
      .plus {
        background: #2c6; /* greenish */
        color: black;
      }
      .minus {
        background: #c33; /* reddish */
        color: white;
      }
      .empty {
        background: black;
      }
      .pacman1 {
        background: gold;
        border-radius: 50%;
      }
      #scoreboard {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-top: 10px;
      }
      .score {
        font-size: 18px;
      }
      #controls {
        display: flex;
        justify-content: center;
        margin: 20px auto;
      }
      .control-set {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 5px;
      }
      .btn {
        padding: 15px;
        font-size: 20px;
        background: #333;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      .btn:active {
        background: #555;
      }
      #gameOverMessage {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: black;
        padding: 40px;
        border-radius: 10px;
        font-size: 28px;
        font-weight: bold;
        z-index: 10;
        color: white;
        white-space: pre-line;
      }
      #frequency {
        margin-top: 10px;
        font-size: 18px;
      }
      #frequency span {
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h1>Grid Frequency Game</h1>
    <div id="scoreboard">
      <div class="score" id="score1">Score: 0</div>
    </div>
    <div id="frequency">Grid Frequency: <span id="freqVal">50.0</span>Hz</div>
    <div id="game-container">
      <div id="game"></div>
    </div>
    <div id="controls">
      <div class="control-set">
        <button class="btn" onclick="setDir1(0, -1)">⬆️</button>
        <button class="btn" onclick="setDir1(-1, 0)">⬅️</button>
        <button class="btn" onclick="setDir1(1, 0)">➡️</button>
        <button class="btn" onclick="setDir1(0, 1)">⬇️</button>
      </div>
    </div>
    <div id="gameOverMessage">Game Over</div>

    <script>
      const width = 15,
        height = 15;
      let game = document.getElementById("game");
      let map = [];
      let pacman1 = { x: 1, y: 1, dx: 0, dy: 0, score: 0, alive: true };
      let frequency = 50.0;
      let loop;

      function generateMap() {
        map = Array.from({ length: height }, (_, y) =>
          Array.from({ length: width }, (_, x) => {
            if (y === 0 || y === height - 1 || x === 0 || x === width - 1)
              return 1;
            if (Math.random() < 0.15) return 1;
            if (Math.random() < 0.15) return Math.random() < 0.5 ? 3 : 4;
            return 2;
          }),
        );
        map[pacman1.y][pacman1.x] = 2;
      }

      function drawMap() {
        game.innerHTML = "";
        game.style.gridTemplateColumns = `repeat(${width}, 20px)`;

        for (let y = 0; y < height; y++) {
          for (let x = 0; x < width; x++) {
            let cell = document.createElement("div");
            cell.className = "cell";

            if (map[y][x] === 1) {
              cell.classList.add("wall");
              if (y === 0) cell.classList.add("top");
              if (y === height - 1) cell.classList.add("bottom");
              if (x === 0) cell.classList.add("left");
              if (x === width - 1) cell.classList.add("right");
            } else if (pacman1.x === x && pacman1.y === y && pacman1.alive) {
              cell.classList.add("pacman1");
            } else if (map[y][x] === 3) {
              cell.classList.add("plus");
              cell.textContent = "+";
            } else if (map[y][x] === 4) {
              cell.classList.add("minus");
              cell.textContent = "−";
            } else {
              cell.classList.add("empty");
            }

            game.appendChild(cell);
          }
        }

        const freqValEl = document.getElementById("freqVal");
        freqValEl.textContent = frequency.toFixed(1);

        if (frequency >= 49.8 && frequency <= 50.2) {
          freqValEl.style.color = "lightgreen";
        } else if (frequency >= 49.5 && frequency <= 50.5) {
          freqValEl.style.color = "orange";
        } else {
          freqValEl.style.color = "red";
        }

        document.getElementById("score1").textContent =
          `Score: ${pacman1.score}`;
      }

      function movePlayer(p) {
        if (!p.alive) return;
        let nx = p.x + p.dx;
        let ny = p.y + p.dy;
        if (map[ny]?.[nx] !== 1) {
          p.x = nx;
          p.y = ny;
          if (map[ny][nx] === 3) {
            frequency += 0.5;
            p.score += 10;
            map[ny][nx] = 2;
          } else if (map[ny][nx] === 4) {
            frequency -= 0.5;
            p.score += 10;
            map[ny][nx] = 2;
          }
        }
      }

      function update() {
        if (Math.random() < 0.2) {
          frequency += (Math.random() - 0.5) * 0.2;
        }

        movePlayer(pacman1);
        drawMap();

        const noItemsLeft = map
          .flat()
          .every((cell) => cell !== 3 && cell !== 4);
        if (noItemsLeft) {
          clearInterval(loop);
          let deviation = Math.abs(50 - frequency);
          let score = Math.max(0, 100 - deviation * 10);
          document.getElementById("gameOverMessage").textContent =
            `Game Over\nScore: ${Math.round(score)}`;
          document.getElementById("gameOverMessage").style.display = "block";
        }
      }

      function setDir1(dx, dy) {
        pacman1.dx = dx;
        pacman1.dy = dy;
      }

      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowUp") setDir1(0, -1);
        if (e.key === "ArrowDown") setDir1(0, 1);
        if (e.key === "ArrowLeft") setDir1(-1, 0);
        if (e.key === "ArrowRight") setDir1(1, 0);
      });

      generateMap();
      drawMap();
      loop = setInterval(update, 200);
    </script>
  </body>
</html>
