<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Guardians of the Grid</title>
    <style>
      /* Dim effect */
      .standard {
        filter: brightness(1);
        transition: filter 1s ease;
      }

      .dimmed {
        filter: brightness(0.5);
        transition: filter 1s ease;
      }

      .brightened {
        filter: brightness(1.5);
        transition: filter 0.75s ease;
      }

      /* Shake effect */
      @keyframes shake {
        0%,
        100% {
          transform: translate(0, 0);
        }
        20%,
        60% {
          transform: translate(-5px, 0);
        }
        40%,
        80% {
          transform: translate(5px, 0);
        }
      }

      .shaking {
        animation: shake 0.5s infinite;
        filter: contrast(1.5);
        transition: filter 1s ease;
      }
      body {
        background: url("guardians-logo.png") center center / 65% no-repeat #111; /* Adjust 200% as needed */
        color: #fff;
        font-family: sans-serif;
        text-align: center;
        margin: 0;
        padding: 0;
      }
      #game-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
      }
      #game {
        display: grid;
        margin: 20px auto;
        gap: 1px;
      }
      .cell {
        width: 20px;
        height: 20px;
        background: black;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 14px;
        color: white;
      }
      .wall {
        background: transparent !important;
        border: none;
        box-shadow: none;
        width: 20px;
        height: 20px;
        box-sizing: border-box;
        margin: 0;
        padding: 0;
        /* Animation for glow */
        animation: wall-glow 2s infinite alternate;
      }

      /* Top border */
      .wall.top {
        border-top: 2px solid #00ffe7;
        box-shadow:
          0 -2px 8px 0 #00ffe7,
          0 -2px 16px 0 #00ffe7;
      }

      /* Bottom border */
      .wall.bottom {
        border-bottom: 2px solid #00ffe7;
        box-shadow:
          0 2px 8px 0 #00ffe7,
          0 2px 16px 0 #00ffe7;
      }

      /* Left border */
      .wall.left {
        border-left: 2px solid #00ffe7;
        box-shadow:
          -2px 0 8px 0 #00ffe7,
          -2px 0 16px 0 #00ffe7;
      }

      /* Right border */
      .wall.right {
        border-right: 2px solid #00ffe7;
        box-shadow:
          2px 0 8px 0 #00ffe7,
          2px 0 16px 0 #00ffe7;
      }

      @keyframes wall-glow {
        0% {
          filter: brightness(1.1) drop-shadow(0 0 4px #00ffe7);
        }
        100% {
          filter: brightness(1.5) drop-shadow(0 0 12px #00ffe7);
        }
      }
      .plus {
        background: #2c6; /* greenish */
        color: black;
      }
      .minus {
        background: #c33; /* reddish */
        color: white;
      }
      .empty {
        background: black;
      }
      .pacman1 {
        background: gold;
        border-radius: 50%;
      }
      #scoreboard {
        display: flex;
        justify-content: center;
        gap: 30px;
        margin-top: 10px;
      }
      #controls {
        background: rgba(0, 0, 0, 0.5);
        border-radius: 10px;
        padding: 10px;
        margin-top: 20px;
        display: inline-block;
      }
      .control-set {
        display: grid;
        grid-template-columns: repeat(3, 60px);
        grid-template-rows: repeat(3, 60px);
        gap: 5px;
        justify-items: center;
        align-items: center;
      }
      .btn {
        padding: 15px;
        font-size: 20px;
        background: #333;
        color: #fff;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      .btn:active {
        background: #555;
      }
      #gameOverMessage {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: black;
        padding: 40px;
        border-radius: 10px;
        font-size: 28px;
        font-weight: bold;
        z-index: 10;
        color: white;
        white-space: pre-line;
      }
      #frequency {
        margin-top: 10px;
        font-size: 18px;
      }
      #frequency span {
        font-weight: bold;
      }
      #start-screen-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: #000;
        z-index: 999;
        display: flex;
        align-items: center;
        justify-content: center;
        animation:
          flicker 2s linear,
          retroFadeIn 1.2s ease-out;
      }

      #start-screen {
        display: flex;
        width: 80%;
        max-width: 900px;
        background: #111;
        border: 2px solid #00ffe7;
        border-radius: 10px;
        padding: 40px;
        color: #00ffe7;
        font-family: "Courier New", Courier, monospace;
        box-shadow:
          0 0 12px #00ffe7,
          0 0 20px #00ffe7;
        animation: glowPulse 2s infinite alternate;
      }

      .left-column,
      .right-column {
        flex: 1;
        padding: 20px;
      }

      .left-column input,
      .left-column button {
        width: 100%;
        padding: 12px;
        margin-top: 10px;
        background: #000;
        color: #00ffe7;
        border: 2px solid #00ffe7;
        font-size: 16px;
        font-family: inherit;
      }

      .left-column button {
        cursor: pointer;
        transition: 0.3s ease;
      }

      .left-column button:hover {
        background: #00ffe7;
        color: #000;
      }

      .right-column ul {
        list-style-type: square;
        padding-left: 20px;
        text-align: left;
        color: #fff;
      }

      @keyframes retroFadeIn {
        0% {
          opacity: 0;
          transform: scale(0.8);
          filter: brightness(0.4) contrast(1.5);
        }
        100% {
          opacity: 1;
          transform: scale(1);
          filter: brightness(1) contrast(1);
        }
      }

      @keyframes glowPulse {
        0% {
          box-shadow:
            0 0 10px #00ffe7,
            0 0 20px #00ffe7;
        }
        100% {
          box-shadow:
            0 0 20px #00ffe7,
            0 0 30px #00ffe7;
        }
      }

      @keyframes flicker {
        0%,
        18%,
        22%,
        25%,
        53%,
        57%,
        100% {
          opacity: 1;
        }
        19%,
        21%,
        24%,
        56% {
          opacity: 0.6;
        }
      }

      .fade-out {
        animation: fadeOut 0.6s ease forwards;
      }

      @keyframes fadeOut {
        0% {
          opacity: 1;
          transform: scale(1);
        }
        100% {
          opacity: 0;
          transform: scale(0.95);
          pointer-events: none;
        }
      }

      #ready-go-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.85); /* darker overlay */
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        font-family: "Courier New", Courier, monospace;
        font-size: 48px;
        font-weight: bold;
        color: #00ffe7;
        text-shadow: 0 0 10px #00ffe7;
        pointer-events: none;
        z-index: 1000;
        opacity: 0;
        transition: opacity 0.2s ease-in-out;
      }

      #ready-text,
      #go-text {
        opacity: 0;
        animation-duration: 0.6s;
        animation-fill-mode: forwards;
      }

      @keyframes showReady {
        0% {
          opacity: 0;
          transform: scale(0.8);
        }
        50% {
          opacity: 1;
          transform: scale(1.1);
        }
        100% {
          opacity: 0;
          transform: scale(1);
        }
      }

      @keyframes showGo {
        0% {
          opacity: 0;
          transform: scale(0.8);
        }
        50% {
          opacity: 1;
          transform: scale(1.1);
        }
        100% {
          opacity: 0;
          transform: scale(1);
        }
      }

      #leaderboard {
        margin-top: 30px;
        color: #fff;
      }

      #leaderboard h3 {
        margin-bottom: 10px;
        color: #00ffe7;
        font-size: 20px;
        border-bottom: 1px solid #00ffe7;
        padding-bottom: 5px;
      }

      #leaderboard-list {
        list-style-type: decimal;
        padding-left: 20px;
        text-align: left;
      }

      #leaderboard-list li {
        margin-bottom: 6px;
      }

      #leaderboard-overlay {
        position: fixed;
        inset: 0; /* top: 0; right: 0; bottom: 0; left: 0 in one line */
        width: 100vw;
        height: 100vh;
        background: rgba(0, 0, 0, 0.9);
        z-index: 1001;
        display: none;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        animation:
          retroFadeIn 1s ease-out,
          flicker 2s infinite;
        overflow: hidden;
      }

      #leaderboard-popup {
        background: #111;
        border: 2px solid #00ffe7;
        padding: 40px;
        border-radius: 10px;
        color: #00ffe7;
        font-family: "Courier New", Courier, monospace;
        box-shadow: 0 0 20px #00ffe7;
        animation: glowPulse 2s infinite alternate;
        text-align: center;
      }

      #leaderboard-popup h2 {
        margin-bottom: 20px;
        border-bottom: 1px solid #00ffe7;
        padding-bottom: 10px;
      }

      #endgame-leaderboard {
        list-style: decimal;
        text-align: left;
        padding-left: 30px;
        margin-bottom: 20px;
      }

      #endgame-leaderboard li {
        margin: 6px 0;
        color: #fff;
      }

      #leaderboard-popup button {
        padding: 10px 20px;
        background: #000;
        color: #00ffe7;
        border: 2px solid #00ffe7;
        font-size: 16px;
        cursor: pointer;
        transition: 0.3s ease;
      }

      #leaderboard-popup button:hover {
        background: #00ffe7;
        color: #000;
      }

      /* === Updated unified background for the entire #game-container === */
      #game-container {
        background: rgba(
          0,
          0,
          0,
          0.6
        ); /* single shared semi-transparent background */
        border-radius: 10px;
        padding: 20px 40px; /* wider padding for comfort */
        margin: 20px auto;
        max-width: fit-content;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        color: white; /* ensure text inside is visible */
      }

      /* Remove individual backgrounds from frequency and timer */
      #frequency,
      #timer {
        background: transparent !important;
        padding: 8px 0; /* vertical spacing only */
        border-radius: 0;
        display: block; /* separate lines */
        margin-top: 10px;
        font-size: 18px;
      }

      /* Make the freq and timer spans slightly bigger */
      #frequency span,
      #timer span {
        font-size: 24px;
        font-weight: bold;
      }

      #intro-screen {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        background: #000;
        z-index: 10000;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        animation: retroFadeIn 1.2s ease-out;
        overflow: hidden;
        padding: 0;
      }

      #intro-logo {
        max-width: 100%;
        width: 600px;
        height: auto;
        image-rendering: pixelated;
        animation: glowPulse 2s infinite alternate;
        margin-bottom: 60px;
      }

      #enter-button {
        padding: 18px 50px;
        font-size: 24px;
        font-family: "Courier New", monospace;
        background: black;
        color: #00ffe7;
        border: 3px solid #00ffe7;
        box-shadow: 0 0 16px #00ffe7;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      #enter-button:hover {
        background: #00ffe7;
        color: black;
        box-shadow:
          0 0 20px #00ffe7,
          0 0 40px #00ffe7;
      }

      .intro-fade-out {
        animation: fadeOut 0.7s ease forwards;
      }

      body.intro-lock {
        overflow: hidden;
      }

      body.leaderboard-lock {
        overflow: hidden;
      }
    </style>
  </head>
  <body>
    <div id="intro-screen">
      <img
        src="guardians-logo.png"
        alt="Guardians of the Grid"
        id="intro-logo"
      />
      <button id="enter-button">ENTER</button>
    </div>

    <div id="start-screen-overlay">
      <div id="start-screen">
        <div class="left-column">
          <form id="start-form" onsubmit="return startGame(event)">
            <h2>Enter Your Name</h2>
            <input
              type="text"
              id="playerName"
              name="playerName"
              required
              autocomplete="off"
            />
            <button type="submit">Start Game</button>
          </form>

          <div id="leaderboard">
            <h3>üèÜ High Scores</h3>
            <ol id="leaderboard-list">
              <li>No data</li>
            </ol>
          </div>
        </div>
        <div class="right-column">
          <h2>How to Play</h2>
          Your goal is to use green energy to balance the grid!

          <ul>
            <li>
              üîã Collect a <strong>+</strong> when the frequency dips. Inject
              more power and get things back on track
            </li>
            <li>
              ü™´ Snatch a <strong>‚àí</strong> when the frequency surges. Store
              that excess energy before it causes chaos
            </li>
            <li>‚ö†Ô∏è But here's the catch: this grid has its limits</li>
            <li>
              ü™® Stray outside the tighter target range of
              <strong>49.8Hz to 50.2Hz</strong>, and you'll see the grid start
              to crumble
            </li>
            <li>üìâ Too low, and power fades into darkness</li>
            <li>
              üìà Too high, and things literally start to break apart! Breach the
              statutory limits and it's GAME OVER
            </li>
          </ul>

          Music: Retro Electro by TheoJT -- https://freesound.org/s/569777/ --
          License: Attribution 4.0
        </div>
      </div>
    </div>

    <div id="ready-go-overlay">
      <div id="ready-text">READY...</div>
      <div id="go-text">GO!</div>
    </div>

    <div id="leaderboard-overlay">
      <div id="leaderboard-popup">
        <h2>üèÜ High Scores</h2>
        <ol id="endgame-leaderboard">
          <!-- Populated by JS -->
        </ol>
        <button onclick="restartGame()">Play Again</button>
        <button onclick="newPlayer()">New Player</button>
      </div>
    </div>

    <div id="game-container">
      <div id="frequency">Grid Frequency: <span id="freqVal">50.0</span>Hz</div>
      <div id="game"></div>
      <div id="timer">
        Time Survived: <span id="timeVal">0.00</span> seconds
      </div>
    </div>
    <div id="controls">
      <div class="control-set">
        <div></div>
        <button class="btn" onclick="setDir1(0, -1)">‚¨ÜÔ∏è</button>
        <div></div>
        <button class="btn" onclick="setDir1(-1, 0)">‚¨ÖÔ∏è</button>
        <div></div>
        <button class="btn" onclick="setDir1(1, 0)">‚û°Ô∏è</button>
        <div></div>
        <button class="btn" onclick="setDir1(0, 1)">‚¨áÔ∏è</button>
        <div></div>
      </div>
    </div>
    <div id="gameOverMessage">Game Over</div>

    <script>
      const width = 15,
        height = 15;
      let game = document.getElementById("game");
      let map = [];
      let pacman1 = { x: 1, y: 1, dx: 0, dy: 0, score: 0, alive: true };
      let frequency = 50.0;
      let loop;
      let paused = false;
      let playerName = "";
      let intervalDelay = 200; // if you're using dynamic speed
      let leaderboard = JSON.parse(localStorage.getItem("leaderboard") || "[]");
      let tickCount = 0;
      let startTime = Date.now();

      function generateMap() {
        map = Array.from({ length: height }, (_, y) =>
          Array.from({ length: width }, (_, x) => {
            if (y === 0 || y === height - 1 || x === 0 || x === width - 1)
              return 1;
            if (Math.random() < 0.3) return Math.random() < 0.5 ? 3 : 4;
            return 2;
          }),
        );
        map[pacman1.y][pacman1.x] = 2;
      }

      function startGame(e) {
        e.preventDefault();
        const name = document.getElementById("playerName").value.trim();
        if (!name) return;

        playerName = document.getElementById("playerName").value.trim();

        const overlay = document.getElementById("start-screen-overlay");
        overlay.classList.add("fade-out");

        setTimeout(() => {
          overlay.style.display = "none";
          showReadyGoFlash(); // Trigger READY/GO!
          startTime = Date.now();

          // ‚úÖ start loop after READY/GO flash is done
          setTimeout(() => {
            loop = setInterval(update, intervalDelay);
          }, 2000); // match READY/GO animation duration
        }, 600);
        return false;
      }

      // Render top 10 players
      function updateLeaderboardDisplay() {
        const list = document.getElementById("leaderboard-list");
        list.innerHTML = "";

        const top10 = leaderboard.slice(0, 10);
        if (top10.length === 0) {
          list.innerHTML = "<li>Who will take the top spot?!</li>";
          return;
        }

        top10.forEach((player) => {
          const li = document.createElement("li");
          li.textContent = `${player.name} ‚Äî ${player.score}`;
          list.appendChild(li);
        });
      }

      window.onload = () => {
        updateLeaderboardDisplay();
        document.body.classList.add("intro-lock");
      };

      function showLeaderboardOverlay() {
        const list = document.getElementById("endgame-leaderboard");
        list.innerHTML = "";

        const top10 = leaderboard.slice(0, 10);
        if (top10.length === 0) {
          list.innerHTML = "<li>Who will take the top spot?!</li>";
        } else {
          top10.forEach((player) => {
            const li = document.createElement("li");
            li.textContent = `${player.name} ‚Äî ${player.score}`;
            list.appendChild(li);
          });
        }

        document.body.classList.add("leaderboard-lock");
        document.getElementById("leaderboard-overlay").style.display = "flex";
      }

      function showReadyGoFlash() {
        const overlay = document.getElementById("ready-go-overlay");
        const ready = document.getElementById("ready-text");
        const go = document.getElementById("go-text");

        // Pause the game logic
        paused = true;
        overlay.style.opacity = 1;

        ready.style.animation = "showReady 1s ease-out";
        setTimeout(() => {
          go.style.animation = "showGo 1s ease-out";
        }, 1000);

        setTimeout(() => {
          overlay.style.opacity = 0;
          ready.style.animation = "";
          go.style.animation = "";
          paused = false; // resume game
          startTime = Date.now();
        }, 2000);
      }

      function drawMap() {
        game.innerHTML = "";
        game.style.gridTemplateColumns = `repeat(${width}, 20px)`;

        for (let y = 0; y < height; y++) {
          for (let x = 0; x < width; x++) {
            let cell = document.createElement("div");
            cell.className = "cell";

            if (map[y][x] === 1) {
              cell.classList.add("wall");
              if (y === 0) cell.classList.add("top");
              if (y === height - 1) cell.classList.add("bottom");
              if (x === 0) cell.classList.add("left");
              if (x === width - 1) cell.classList.add("right");
            } else if (pacman1.x === x && pacman1.y === y && pacman1.alive) {
              cell.classList.add("pacman1");
            } else if (map[y][x] === 3) {
              cell.classList.add("plus");
              cell.textContent = "+";
            } else if (map[y][x] === 4) {
              cell.classList.add("minus");
              cell.textContent = "‚àí";
            } else {
              cell.classList.add("empty");
            }

            game.appendChild(cell);
          }
        }

        const freqValEl = document.getElementById("freqVal");
        freqValEl.textContent = frequency.toFixed(5);

        if (frequency >= 49.8 && frequency <= 50.2) {
          freqValEl.style.color = "lightgreen";
        } else if (frequency >= 49.5 && frequency <= 50.5) {
          freqValEl.style.color = "orange";
        } else {
          freqValEl.style.color = "red";
        }
      }

      function movePlayer(p) {
        if (!p.alive) return;
        let nx = p.x + p.dx;
        let ny = p.y + p.dy;
        if (map[ny]?.[nx] !== 1) {
          p.x = nx;
          p.y = ny;
          if (map[ny][nx] === 3) {
            frequency += 0.1;
            map[ny][nx] = 2;
          } else if (map[ny][nx] === 4) {
            frequency -= 0.1;
            map[ny][nx] = 2;
          }
        }
      }

      function update() {
        if (paused) return; // stop updating during overlay

        tickCount++;

        const maxDeviation = 0.15;
        const minDeviation = 0.01;
        const currentDeviation =
          minDeviation + ((maxDeviation - minDeviation) * tickCount) / 60;

        if (Math.random() < 0.25) {
          frequency += (Math.random() - 0.5) * currentDeviation * 2;
        }

        movePlayer(pacman1);
        drawMap();

        // Update timer on screen
        const elapsed = ((Date.now() - startTime) / 1000).toFixed(2);
        document.getElementById("timeVal").textContent = elapsed;

        const body = document.body;

        if (frequency < 49.8) {
          body.classList.add("dimmed");
          body.classList.add("shaking");
        } else {
          body.classList.remove("dimmed");
          body.classList.remove("shaking");
          body.classList.add("standard");
        }

        if (frequency > 50.2) {
          body.classList.add("brightened");
          body.classList.add("shaking");
        } else {
          body.classList.remove("brightened");
          body.classList.remove("shaking");
          body.classList.add("standard");
        }

        // Check if frequency out of bounds -> game over
        if (frequency < 49.5 || frequency > 50.5) {
          clearInterval(loop);

          // üîá Stop background music
          const music = document.getElementById("game-music");
          music.pause();
          music.currentTime = 0;

          // üîä Play game over sound
          document.getElementById("game-over-sound").play();

          // Save to leaderboard
          leaderboard.push({ name: playerName, score: parseFloat(elapsed) });
          leaderboard.sort((a, b) => b.score - a.score);
          leaderboard = leaderboard.slice(0, 10);
          localStorage.setItem("leaderboard", JSON.stringify(leaderboard));

          document.getElementById("gameOverMessage").textContent =
            `üõë Grid Out of Limits\nYou survived ${elapsed} seconds`;
          document.getElementById("gameOverMessage").style.display = "block";

          // Show leaderboard overlay after brief pause
          setTimeout(showLeaderboardOverlay, 4000);
          return;
        }

        // Check if all plus and minus are collected
        const noItemsLeft = map
          .flat()
          .every((cell) => cell !== 3 && cell !== 4);

        if (noItemsLeft) {
          // Generate 10 new items randomly on empty cells (value 2)
          for (let i = 0; i < 10; i++) {
            let rx, ry;
            do {
              rx = Math.floor(Math.random() * width);
              ry = Math.floor(Math.random() * height);
            } while (
              map[ry][rx] !== 2 ||
              (rx === pacman1.x && ry === pacman1.y)
            );

            map[ry][rx] = Math.random() < 0.5 ? 3 : 4;
          }

          // Increase game speed by decreasing intervalDelay, minimum 50ms
          if (intervalDelay > 50) {
            clearInterval(loop);
            intervalDelay = Math.max(50, intervalDelay - 20);
            loop = setInterval(update, intervalDelay);
          }
        }
      }

      function setDir1(dx, dy) {
        pacman1.dx = dx;
        pacman1.dy = dy;
      }

      function restartGame() {
        document.getElementById("leaderboard-overlay").style.display = "none";
        document.getElementById("gameOverMessage").style.display = "none";

        // stop residual shaking
        document.body.classList.remove(
          "shaking",
          "dimmed",
          "brightened",
          "standard",
        );

        pacman1 = { x: 1, y: 1, dx: 0, dy: 0, score: 0, alive: true };
        frequency = 50.0;
        tickCount = 0;
        startTime = Date.now(); // ‚úÖ Reset the timer start time here
        intervalDelay = 200; // (optional) reset speed if it was increasing
        generateMap();
        drawMap();

        // üîä Restart music
        document.getElementById("game-music").play();
        showReadyGoFlash(); // üé¨ Show animation
        setTimeout(() => {
          loop = setInterval(update, intervalDelay); // ‚èØ Start game after READY/GO
        }, 2000); // match duration of READY/GO flash
      }

      function newPlayer() {
        // Hide leaderboard and game over message
        document.getElementById("leaderboard-overlay").style.display = "none";
        document.getElementById("gameOverMessage").style.display = "none";

        // stop residual shaking
        document.body.classList.remove(
          "shaking",
          "dimmed",
          "brightened",
          "standard",
        );

        // Reset name input
        document.getElementById("playerName").value = "";

        // Show the start screen overlay again
        const startScreen = document.getElementById("start-screen-overlay");
        startScreen.classList.remove("fade-out"); // Reset any fade-out effect
        startScreen.style.display = "flex";

        // Reset game state
        pacman1 = { x: 1, y: 1, dx: 0, dy: 0, score: 0, alive: true };
        frequency = 50.0;
        tickCount = 0;
        intervalDelay = 200;
        clearInterval(loop);
        generateMap();
        drawMap();

        // üîä Restart music
        document.getElementById("game-music").play();

        playerName = "";
      }

      document.addEventListener("keydown", (e) => {
        if (e.key === "ArrowUp") setDir1(0, -1);
        if (e.key === "ArrowDown") setDir1(0, 1);
        if (e.key === "ArrowLeft") setDir1(-1, 0);
        if (e.key === "ArrowRight") setDir1(1, 0);
      });

      document.getElementById("enter-button").addEventListener("click", () => {
        // üîä Unmute and play music
        const music = document.getElementById("game-music");
        music.muted = false;
        music.play();

        const intro = document.getElementById("intro-screen");
        const startOverlay = document.getElementById("start-screen-overlay");

        intro.classList.add("intro-fade-out");

        setTimeout(() => {
          intro.style.display = "none";
          startOverlay.style.display = "flex";

          // Unlock scroll when intro is gone
          document.body.classList.remove("intro-lock");
        }, 700); // Match fadeOut duration
      });

      generateMap();
      drawMap();
    </script>
    <audio id="game-over-sound" src="game_over.wav" preload="auto"></audio>
    <audio
      id="game-music"
      src="main_sound.mp3"
      preload="auto"
      loop
      muted
    ></audio>
  </body>
</html>
